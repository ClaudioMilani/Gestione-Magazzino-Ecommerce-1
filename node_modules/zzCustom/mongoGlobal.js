var MongoClient = require('mongodb').MongoClient;
var ObjectID = require("mongodb").ObjectID;
var url = 'mongodb://vNpuXnYG6l:5fDwqSauGF@ds052649.mlab.com:52649/magazine';

module.exports = {
    get: function () {

        MongoClient.connect(url, function (err, db) {
            if (err) {
                console.log(err);
                callback(err);
            }
            findDati(db, collection, function (data) {
                db.close();
                callback(data);
            });
        });
    }
};

var findDati = function (db, collezione, callback) {
    var data = '{ "rows" : [';
    var cursor = db.collection(collezione).find();
    cursor.each(function (err, doc) {
        if (err) {
            console.log(err);
            return err;
        }
        if (doc != null) {
            if (data != '{ "rows" : [')
                data += ','
            data += JSON.stringify(doc);
        } else {
            data += '] }';
            callback(JSON.parse(data));
        }
    });
};